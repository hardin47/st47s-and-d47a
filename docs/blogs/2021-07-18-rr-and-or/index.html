<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jo Hardin">
<meta name="dcterms.date" content="2021-06-10">
<meta name="description" content="Why relative risk should not be calculated on data sampled using a case control study.">

<title>Jo Hardin - Relative Risk and Odds Ratios</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../img/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../img/favicon.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Jo Hardin</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../courses.html" rel="" target="">
 <span class="menu-text">courses</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../research.html" rel="" target="">
 <span class="menu-text">research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html" rel="" target="">
 <span class="menu-text">projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blogs.html" rel="" target="">
 <span class="menu-text">blogs</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#definitions" id="toc-definitions" class="nav-link" data-scroll-target="#definitions">Definitions</a></li>
  <li><a href="#are-odds-difficult-to-understand" id="toc-are-odds-difficult-to-understand" class="nav-link" data-scroll-target="#are-odds-difficult-to-understand">Are odds difficult to understand?</a></li>
  <li><a href="#can-we-force-the-rr-to-be-anything-we-want" id="toc-can-we-force-the-rr-to-be-anything-we-want" class="nav-link" data-scroll-target="#can-we-force-the-rr-to-be-anything-we-want">Can we force the RR to be anything we want?</a></li>
  <li><a href="#more-thoughts-on-rr-and-or" id="toc-more-thoughts-on-rr-and-or" class="nav-link" data-scroll-target="#more-thoughts-on-rr-and-or">More thoughts on RR and OR</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Relative Risk and Odds Ratios</h1>
</div>

<div>
  <div class="description">
    Why relative risk should not be calculated on data sampled using a case control study.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jo Hardin </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 10, 2021</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>There are many good reasons to choose a case control study as the experimental design. Most notably, in many scenarios, cases are somewhat difficult to come by, and if observations are determined by treatment / control (i.e., a cohort study) then the study can end up with too few cases observed for any type of conclusion (i.e., the study will be under-powered). See recent case-control studies <a href="https://pubmed.ncbi.nlm.nih.gov/32931726/">here</a> and <a href="https://pubmed.ncbi.nlm.nih.gov/33052324/">here</a> and <a href="https://pubmed.ncbi.nlm.nih.gov/34273049/">here</a>.</p>
<p>However, when teaching about case-control studies, it is paramount to include a thorough dive into odds ratios and the need to use odds ratios (instead of relative risk or differences in proportions) to summarize case-control studies. There are many good resources for learning about case-control studies (e.g., <a href="https://sphweb.bumc.bu.edu/otlt/mph-modules/ep/ep713_analyticoverview/ep713_analyticoverview5.html">here</a> and <a href="https://sphweb.bumc.bu.edu/otlt/mph-modules/ep/ep713_association/EP713_Association8.html">here</a> and <a href="https://pubmed.ncbi.nlm.nih.gov/6613982/">here</a> and <a href="https://www.karger.com/Article/FullText/334180">here</a> and <a href="https://www.gfmer.ch/Books/Reproductive_health/Cohort_and_case_control_studies.htm">here</a>), but many of the ideas below come from the excellent introductory statistics textbook, <a href="http://www.rossmanchance.com/iscam3/">Introduction to Statistical Concepts, Applications, and Methods</a> by Chance and Rossman.</p>
</section>
<section id="definitions" class="level2">
<h2 class="anchored" data-anchor-id="definitions">Definitions</h2>
<p>A case-control study is one in which the <strong>observational units are selected in such a way that there are a set number of cases and a set number of controls</strong>. (As compared with a cohort study where the observational units are selected in such a way that there are a set number in treatment group 1 and a set number in treatment group 2.)</p>
<section id="types-of-studies" class="level4">
<h4 class="anchored" data-anchor-id="types-of-studies">Types of Studies</h4>
<ul>
<li><p><strong>Explanatory variable</strong> is one that is a potential explanation for any changes in the response variable.</p></li>
<li><p><strong>Response variable</strong> is the measured outcome of interest.</p></li>
<li><p><strong>Case-control study:</strong> identify observational units by response (i.e., case or control).</p></li>
<li><p><strong>Cohort study:</strong> identify observational units by explanatory variable (i.e., treatment or placebo).</p></li>
<li><p><strong>Cross-classification study:</strong> identify observational units regardless of levels of the variable.</p></li>
</ul>
</section>
<section id="relative-risk" class="level4">
<h4 class="anchored" data-anchor-id="relative-risk"><strong>Relative Risk</strong></h4>
<p>The relative risk (RR) is the ratio of risks for each group. We say, ‚ÄúThe risk of success is <strong>RR</strong> times for those in group 1 as compared to those in group 2.‚Äù</p>
<p><span class="math display">\[
\begin{aligned}
\mbox{relative risk} &amp;= \frac{\mbox{risk group 1}}{\mbox{risk group 2}}\\
&amp;=  \frac{\mbox{proportion of successes in group 1}}{\mbox{proportion of successes in group 2}}\\
\mbox{RR} &amp;= \frac{p_1}{p_2} = \frac{p_1}{p_2}\\
\hat{\mbox{RR}} &amp;= \frac{\hat{p}_1}{\hat{p}_2}
\end{aligned}
\]</span></p>
</section>
<section id="odds-ratio" class="level4">
<h4 class="anchored" data-anchor-id="odds-ratio"><strong>Odds Ratio</strong></h4>
<p>A related concept to risk is odds. It is often used in horse racing, where ‚Äúsuccess‚Äù is typically defined as losing. So, if the odds are 3 to 1 we would expect to lose 3/4 of the time. The odds ratio (OR) is the ratio of odds for each group. We say, ‚ÄúThe odds of success is <strong>OR</strong> times for those in group 1 as compared to those group 2.‚Äù</p>
<p><span class="math display">\[\begin{eqnarray*}
\mbox{odds} &amp;=&amp; \frac{\mbox{proportion of successes}}{\mbox{proportion of failures}}\\
&amp;=&amp; \frac{\mbox{number of successes}}{\mbox{number of failures}} = \theta\\
\hat{\mbox{odds}} &amp;=&amp; \hat{\theta}\\
\mbox{odds ratio} &amp;=&amp; \frac{\mbox{odds group 1}}{\mbox{odds group 2}} \\
\mbox{OR} &amp;=&amp; \frac{\theta_1}{\theta_2} = \frac{p_1/(1-p_1)}{p_2/(1-p_2)}= \frac{p_1/(1-p_1)}{p_2/(1-p_2)}\\
\hat{\mbox{OR}} &amp;=&amp; \frac{\hat{\theta}_1}{\hat{\theta}_2} = \frac{\hat{p}_1/(1-\hat{p}_1)}{\hat{p}_2/(1-\hat{p}_2)}\\
\end{eqnarray*}\]</span></p>
</section>
</section>
<section id="are-odds-difficult-to-understand" class="level2">
<h2 class="anchored" data-anchor-id="are-odds-difficult-to-understand">Are odds difficult to understand?</h2>
<p>If you, like me, grew up in a world of proportions and percentages, the first time you encounter odds, it might seem like an <em>odd</em> statistic. However, I‚Äôd like to argue that, fundamentally, the idea of odds is no different from the idea of risk (or proportion). The cognitive difficulty in remembering and communicating about odds comes with the fact that we‚Äôve wired our brains so completely to think primarily about proportions.</p>
<p>But what if you had grown up thinking about odds? What if you had had a placement at your kitchen table describing the odds of an event (instead of the proportion of the event)? You might find that the odds are actually easier to interpret than a proportion.</p>
<p>I posit that if you (or your students) had grown up with a kitchen table placemat as seen in <a href="#fig-oddspm">Figure&nbsp;2</a>, you would find risk to be the <em>odd</em> concept and odds to be the intuitive idea.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-riskpm" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="riskplacemat.png" class="img-fluid figure-img" alt="Six different pie charts are shown, each with a different number of equivalently sized pie pieces colored either blue or orange.  For example, one pie has three blue and two orange pieces.  Below that particular pie is written 3/5 = 0.6 which is the risk or the proportion of blue pie pieces." width="1041"></p>
<figcaption class="figure-caption">Figure&nbsp;1: A child‚Äôs kitchen placemat designed to teach proportions, often called risk in medical studies.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-oddspm" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="oddsplacemat.png" class="img-fluid figure-img" alt="Six different pie charts are shown, each with a different number of equivalently sized pie pieces colored either blue or orange.  For example, one pie has three blue and two orange pieces.  Below that particular pie is written 3/2 = 1.5 which is the odds of the blue pie pieces." width="1043"></p>
<figcaption class="figure-caption">Figure&nbsp;2: An alternative child‚Äôs kitchen placemat designed to teach odds.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="can-we-force-the-rr-to-be-anything-we-want" class="level2">
<h2 class="anchored" data-anchor-id="can-we-force-the-rr-to-be-anything-we-want">Can we force the RR to be anything we want?</h2>
<p>The motivation for writing this blog entry came from the <a href="https://hardin47.shinyapps.io/RROR/">Shiny App</a> below. It takes a little bit of thinking, but hopefully we can see that if we select observational units based on cases and controls, the individual risk (per treatment group) is not measurable. Why? Well, if we just keep selecting more cases, the risk in each group will keep going up! (Note: by selecting more cases, the odds will also keep going up.)</p>
<p>What about <strong>relative risk</strong> and <strong>odds ratios</strong>? It turns out that with the case-control experimental design the calculation of the relative risk depends on which variable is explanatory and which variable is response. HOWEVER, the calculation of the odds ratio does not depend on which variable is explanatory and which variable is response.</p>
<p><strong>Conclusion</strong> Regardless of how many cases or controls are sampled, the odds ratio calculated from data in a case control-study is a good estimate of the population odds ratio.</p>
<iframe height="800" width="100%" frameborder="no" src="https://hardin47.shinyapps.io/RROR/">
</iframe>
</section>
<section id="more-thoughts-on-rr-and-or" class="level2">
<h2 class="anchored" data-anchor-id="more-thoughts-on-rr-and-or">More thoughts on RR and OR</h2>
<section id="odds-ratios-are-hard-to-interpret" class="level4">
<h4 class="anchored" data-anchor-id="odds-ratios-are-hard-to-interpret">Odds Ratios are hard to interpret</h4>
<p>After an odds ratio (of XXX) has been calculated, the correct interpretation is that the odds of success for group 1 are XXX times the odds of success for group 2. There might be a tendency to say that the probability of success (or risk of success) in group 1 are XXX times that of group 2. But remember, risk and odds are different numbers (see <a href="#fig-riskpm">Figure&nbsp;1</a> and <a href="#fig-oddspm">Figure&nbsp;2</a>), so odds ratios and relative risk measure quotients of different things.</p>
</section>
<section id="can-you-explain-that-calculation-part-one-more-time" class="level4">
<h4 class="anchored" data-anchor-id="can-you-explain-that-calculation-part-one-more-time">Can you explain that calculation part one more time?</h4>
<p>Example taken from <a href="http://www.rossmanchance.com/iscam3/">Introduction to Statistical Concepts, Applications, and Methods</a> by Chance and Rossman.</p>
<p>Let‚Äôs say we have a <em>population</em> of 1,000,000 people:</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th>cancer</th>
<th>healthy</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>light smoking</td>
<td>49,000</td>
<td>51,000</td>
<td>100,000</td>
</tr>
<tr class="even">
<td>no smoking</td>
<td>1,000</td>
<td>899,000</td>
<td>900,000</td>
</tr>
<tr class="odd">
<td></td>
<td>50,000</td>
<td>950,000</td>
<td>1,000,000</td>
</tr>
</tbody>
</table>
<p><span class="math display">\[\begin{eqnarray*}
P(\mbox{light} | \mbox{lung cancer}) &amp;=&amp; \frac{49,000}{50,000} = 0.98\\
P(\mbox{lung cancer} | \mbox{light}) &amp;=&amp; \frac{49,000}{100,000} = 0.49\\
\end{eqnarray*}\]</span></p>
<table class="table">
<thead>
<tr class="header">
<th>Group A</th>
<th>Group B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>expl = smoking status</td>
<td>expl = lung cancer</td>
</tr>
<tr class="even">
<td>resp = lung cancer</td>
<td>resp = smoking status</td>
</tr>
</tbody>
</table>
<ul>
<li>Group A: Calculate the relative risk and odds ratio under the setting that lung cancer is considered a success and no smoking is baseline:</li>
</ul>
<p><span class="math display">\[\begin{eqnarray*}
RR &amp;=&amp; \frac{49/100}{1/900} = 441\\
OR &amp;=&amp; \frac{49/51}{1/899} = 863.75\\
\end{eqnarray*}\]</span></p>
<ul>
<li>Group B: Calculate the relative risk and odds ratio under the setting that light smoking is considered a success and healthy is baseline:</li>
</ul>
<p><span class="math display">\[\begin{eqnarray*}
RR &amp;=&amp; \frac{49/50}{51/950} = 18.25\\
OR &amp;=&amp; \frac{49/1}{51/899} = 863.75\\
\end{eqnarray*}\]</span></p>
<p>OR is the same no matter which variable you choose as explanatory versus response!</p>
</section>
<section id="are-or-and-rr-ever-numerically-similar-equivalent" class="level4">
<h4 class="anchored" data-anchor-id="are-or-and-rr-ever-numerically-similar-equivalent">Are OR and RR ever numerically similar / equivalent?</h4>
<p>If <span class="math inline">\(p_1\)</span> and <span class="math inline">\(p_2\)</span> are both very small, then <span class="math display">\[1-p_1 \approx 1- p_2 \approx 1\]</span> which gives:</p>
<p><span class="math display">\[RR = \frac{p_1}{p_2} \approx \frac{p_1 / (1 - p_1)}{p_2/(1-p_2)} = OR.\]</span></p>
<p>In situations of extremely rare diseases (and case-control studies), it makes sense to calculate the odds ratio and interpret the number as if it was relative risk.</p>
</section>
<section id="or-is-always-more-extreme-than-rr" class="level4">
<h4 class="anchored" data-anchor-id="or-is-always-more-extreme-than-rr">OR is always more extreme than RR</h4>
<p>Without loss of generality, assume the true <span class="math inline">\(RR &gt; 1\)</span>, implying <span class="math inline">\(p_1 / p_2 &gt; 1\)</span> and <span class="math inline">\(p_1 &gt; p_2\)</span>.</p>
<p>Note the following sequence of consequences:</p>
<p><span class="math display">\[\begin{eqnarray*}
RR = \frac{p_1}{p_2} &amp;&gt;&amp; 1\\
\frac{1 - p_1}{1 - p_2} &amp;&lt;&amp; 1\\
\frac{ 1 / (1 - p_1)}{1 / (1 - p_2)} &amp;&gt;&amp; 1\\
\frac{p_1}{p_2} \cdot \frac{ 1 / (1 - p_1)}{1 / (1 - p_2)} &amp;&gt;&amp; \frac{p_1}{p_2}\\
OR &amp;&gt;&amp; RR
\end{eqnarray*}\]</span></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">¬© Copyright 2023, Jo Hardin</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Built with üíö and <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>